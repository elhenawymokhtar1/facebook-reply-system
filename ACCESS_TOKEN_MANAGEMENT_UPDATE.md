# ๐ ุชุญุฏูุซ ุฅุฏุงุฑุฉ ุงูู Access Token - ุญูุงูุฉ ูุงููุฉ

## ๐ฏ **ุงููุดููุฉ ุงูุชู ุชู ุญููุง**

**ุงููุดููุฉ ุงูุณุงุจูุฉ:** ูุทุน ุงูุงุชุตุงู ูุงู ูุนุทู ุงูุตูุญุฉ ูู ุงููุงุฌูุฉ ููุทุ ููู ุงูู Access Token ูุงู ูุง ูุฒุงู ููุฌูุฏ ููููู ุงุณุชุฎุฏุงูู ููุฅุฑุณุงู ูุงูุงุณุชูุจุงู.

**ุงูุญู ุงูุฌุฏูุฏ:** ูุทุน ุงูุงุชุตุงู ุงูุขู ูุฒูู ุงูู Access Token ูุคูุชุงู ููุญูุธู ูู ููุงู ุขููุ ููุง ูููุน ุฃู ูุตูู ููุตูุญุฉ ุญุชู ุฅุนุงุฏุฉ ุงูุชูุนูู.

---

## โจ **ุงูุชุญุฏูุซุงุช ุงููุถุงูุฉ**

### **๐ ุฅุฏุงุฑุฉ ุงูู Access Token:**

#### **ุนูุฏ ูุทุน ุงูุงุชุตุงู:**
```sql
UPDATE facebook_settings SET 
  is_active = false,
  disconnected_at = NOW(),
  backup_access_token = access_token,  -- ุญูุธ ุงุญุชูุงุทู
  access_token = NULL                  -- ุฅุฒุงูุฉ ุงููุตูู
WHERE page_id = ?;
```

#### **ุนูุฏ ุฅุนุงุฏุฉ ุงูุชูุนูู:**
```sql
UPDATE facebook_settings SET 
  is_active = true,
  disconnected_at = NULL,
  access_token = backup_access_token,  -- ุฅุฑุฌุงุน ุงููุตูู
  backup_access_token = NULL           -- ูุณุญ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ
WHERE page_id = ?;
```

### **๐ก๏ธ ูุญุต ูุฒุฏูุฌ ูู ุงูู Webhook:**
```javascript
// ูุญุต 1: ูู ุงูุตูุญุฉ ูุดุทุฉุ
if (pageSettings.is_active === false) {
  return; // ุชุฌุงูู ุงูุฑุณุงูุฉ
}

// ูุญุต 2: ูู ููุฌุฏ Access Tokenุ
if (!pageSettings.access_token) {
  return; // ุชุฌุงูู ุงูุฑุณุงูุฉ
}
```

---

## ๐๏ธ **ูุงุนุฏุฉ ุงูุจูุงูุงุช**

### **ุงูุนููุฏ ุงูุฌุฏูุฏ:**
```sql
ALTER TABLE facebook_settings 
ADD COLUMN backup_access_token TEXT;
```

### **ุญุงูุงุช ุงูุจูุงูุงุช:**

#### **ุตูุญุฉ ูุดุทุฉ:**
```
is_active: true
access_token: "EAAUpPO0SIEABO..."
backup_access_token: NULL
disconnected_at: NULL
```

#### **ุตูุญุฉ ูุนุทูุฉ:**
```
is_active: false
access_token: NULL
backup_access_token: "EAAUpPO0SIEABO..."
disconnected_at: "2025-05-30T21:00:00Z"
```

---

## ๐ **ุฃุณุจุงุจ ุชุฌุงูู ุงูุฑุณุงุฆู**

### **ุงูุณุจุจ ุงูุฃูู: `page_disabled`**
```
๐ซ ุงูุตูุญุฉ "ุงุณู ุงูุตูุญุฉ" ูุนุทูุฉ - ุชู ุชุฌุงูู ุงูุฑุณุงูุฉ
๐ ุชุงุฑูุฎ ูุทุน ุงูุงุชุตุงู: 2025-05-30T21:00:00Z
```

### **ุงูุณุจุจ ุงูุซุงูู: `no_access_token`**
```
๐ ุงูุตูุญุฉ "ุงุณู ุงูุตูุญุฉ" ุจุฏูู Access Token - ุชู ุชุฌุงูู ุงูุฑุณุงูุฉ
```

---

## ๐จ **ูุงุฌูุฉ ุงููุณุชุฎุฏู**

### **ุฑุณุงุฆู ุงูุชุฃููุฏ ุงููุญุฏุซุฉ:**

#### **ูุทุน ุงูุงุชุตุงู:**
```
ูู ุฃูุช ูุชุฃูุฏ ูู ูุทุน ุงูุงุชุตุงู ูุน ุตูุญุฉ "ุงุณู ุงูุตูุญุฉ"ุ

โ๏ธ ุณูุชู:
- ุฅููุงู ุงุณุชูุจุงู ุงูุฑุณุงุฆู ูุคูุชุงู
- ุฅุฒุงูุฉ ุงูู Access Token ูุคูุชุงู
- ูููู ุฅุนุงุฏุฉ ุงูุชูุนูู ูุงุญูุงู ุจุฏูู ุฅุนุงุฏุฉ ุฑุจุท
```

#### **ุฅุนุงุฏุฉ ุงูุชูุนูู:**
```
ูู ุชุฑูุฏ ุฅุนุงุฏุฉ ุชูุนูู ุตูุญุฉ "ุงุณู ุงูุตูุญุฉ"ุ

โ ุณูุชู:
- ุงุณุชุฆูุงู ุงุณุชูุจุงู ุงูุฑุณุงุฆู
- ุฅุฑุฌุงุน ุงูู Access Token ุงููุญููุธ
- ุชูุนูู ุฌููุน ุงููุธุงุฆู
```

### **ุงูุชุญุฐูุฑุงุช ุงูุจุตุฑูุฉ:**
```
โ๏ธ ูุฐู ุงูุตูุญุฉ ูุนุทูุฉ ููุง ุชุณุชูุจู ุฑุณุงุฆู ุฌุฏูุฏุฉ
ุชู ุฅุฒุงูุฉ ุงูู Access Token ูุคูุชุงู - ุณูุชู ุฅุฑุฌุงุนู ุนูุฏ ุฅุนุงุฏุฉ ุงูุชูุนูู
```

---

## ๐งช **ุงุฎุชุจุงุฑ ุงููุธุงู**

### **1๏ธโฃ ุงุฎุชุจุงุฑ ูุทุน ุงูุงุชุตุงู:**
```bash
# ูุจู ูุทุน ุงูุงุชุตุงู
curl -X POST http://localhost:3003/webhook \
  -H "Content-Type: application/json" \
  -d '{"object":"page","entry":[...]}'
# ุงููุชูุฌุฉ: ุงูุฑุณุงูุฉ ุชูุนุงูุฌ โ

# ุจุนุฏ ูุทุน ุงูุงุชุตุงู
curl -X POST http://localhost:3003/webhook \
  -H "Content-Type: application/json" \
  -d '{"object":"page","entry":[...]}'
# ุงููุชูุฌุฉ: ุงูุฑุณุงูุฉ ุชูุชุฌุงูู ๐ซ
```

### **2๏ธโฃ ูุฑุงูุจุฉ ุงูุฅุญุตุงุฆูุงุช:**
```bash
curl http://localhost:3003/health
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
```json
{
  "messagesIgnored": 5,
  "lastIgnoredMessage": {
    "pageId": "260345600493273",
    "pageName": "ุงุณู ุงูุตูุญุฉ",
    "reason": "no_access_token",
    "timestamp": "2025-05-30T21:10:00.000Z"
  }
}
```

---

## ๐ก๏ธ **ุงูุฃูุงู ูุงูุญูุงูุฉ**

### **๐ ูุณุชููุงุช ุงูุญูุงูุฉ:**

#### **ุงููุณุชูู ุงูุฃูู: ูุงุนุฏุฉ ุงูุจูุงูุงุช**
- ุฅุฒุงูุฉ ุงูู Access Token ูู ุงูุนููุฏ ุงูุฃุณุงุณู
- ุญูุธ ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูุดูุฑุฉ
- ุชุณุฌูู ุชุงุฑูุฎ ูุทุน ุงูุงุชุตุงู

#### **ุงููุณุชูู ุงูุซุงูู: ุงูู Webhook**
- ูุญุต ุญุงูุฉ ุงูุชูุนูู
- ูุญุต ูุฌูุฏ ุงูู Access Token
- ุชุฌุงูู ุงูุฑุณุงุฆู ููุตูุญุงุช ุงููุนุทูุฉ

#### **ุงููุณุชูู ุงูุซุงูุซ: ุงูุชุทุจูู**
- ููุน ุฅุฑุณุงู ุงูุฑุณุงุฆู ููุตูุญุงุช ุงููุนุทูุฉ
- ุนุฑุถ ุชุญุฐูุฑุงุช ูุงุถุญุฉ
- ุชุฃููุฏ ูุฒุฏูุฌ ููุนูููุงุช ุงูุญุณุงุณุฉ

---

## ๐ **ูุฑุงูุจุฉ ุงููุธุงู**

### **๐ฅ Health Check:**
```bash
curl http://localhost:3003/health
```

### **๐ ุฅุญุตุงุฆูุงุช ููุตูุฉ:**
- **ุงูุฑุณุงุฆู ุงููุณุชูุจูุฉ:** ุนุฏุฏ ุงูุฑุณุงุฆู ุงููุนุงูุฌุฉ
- **ุงูุฑุณุงุฆู ุงููุชุฌุงููุฉ:** ุนุฏุฏ ุงูุฑุณุงุฆู ุงููุฑููุถุฉ
- **ุขุฎุฑ ุฑุณุงูุฉ ูุชุฌุงููุฉ:** ุชูุงุตูู ูุงููุฉ ูุน ุงูุณุจุจ

### **๐ ุฃุณุจุงุจ ุงูุชุฌุงูู:**
- `page_disabled`: ุงูุตูุญุฉ ูุนุทูุฉ
- `no_access_token`: ูุง ููุฌุฏ Access Token

---

## ๐ **ุงูููุงุฆุฏ**

### **๐ ุฃูุงู ูุญุณู:**
- **ููุน ุงููุตูู ุบูุฑ ุงููุตุฑุญ:** ููุตูุญุงุช ุงููุนุทูุฉ
- **ุญูุงูุฉ ุงูู Access Token:** ูู ุงูุงุณุชุฎุฏุงู ุบูุฑ ุงููุฑุบูุจ
- **ุชุญูู ุฏููู:** ูู ูู ุตูุญุฉ ุจุดูู ูููุตู

### **๐ก ุณูููุฉ ุงูุงุณุชุฎุฏุงู:**
- **ุฅุนุงุฏุฉ ุชูุนูู ุณุฑูุนุฉ:** ุจุฏูู ุฅุนุงุฏุฉ ุฑุจุท
- **ุญูุธ ุชููุงุฆู:** ููุฅุนุฏุงุฏุงุช ูุงูู Tokens
- **ุฑุณุงุฆู ูุงุถุญุฉ:** ููู ุนูููุฉ

### **๐ ุฃุฏุงุก ูุญุณู:**
- **ุชูููุฑ ุงูููุงุฑุฏ:** ุจุนุฏู ูุนุงูุฌุฉ ุฑุณุงุฆู ุบูุฑ ูุทููุจุฉ
- **ูุญุต ุณุฑูุน:** ูุจู ุงููุนุงูุฌุฉ ุงูุซูููุฉ
- **ุฅุญุตุงุฆูุงุช ุฏูููุฉ:** ููุฑุงูุจุฉ ุงููุดุงุท

---

## ๐ฏ **ุงููุชูุฌุฉ ุงูููุงุฆูุฉ**

### **โ ูุง ุชู ุชุญูููู:**
- **๐ ุญูุงูุฉ ูุงููุฉ** ููู Access Token
- **๐ก๏ธ ููุน ุงููุตูู** ููุตูุญุงุช ุงููุนุทูุฉ
- **๐ ุฅุนุงุฏุฉ ุชูุนูู ุณููุฉ** ุจุฏูู ุฅุนุงุฏุฉ ุฑุจุท
- **๐ ูุฑุงูุจุฉ ุดุงููุฉ** ูุฌููุน ุงูุนูููุงุช

### **๐ ุงููุชูุฌุฉ:**
**ุงูุขู ูุทุน ุงูุงุชุตุงู ูุนูู ูุทุน ุงุชุตุงู ุญูููู!**
- โ ูุง ูููู ุฅุฑุณุงู ุฑุณุงุฆู
- โ ูุง ูููู ุงุณุชูุจุงู ุฑุณุงุฆู  
- โ ูุง ูููู ุงููุตูู ููู API
- โ ูููู ุฅุนุงุฏุฉ ุงูุชูุนูู ุจุณูููุฉ

**ุงููุธุงู ูุญูู ุจุงููุงูู! ๐ก๏ธ๐**
