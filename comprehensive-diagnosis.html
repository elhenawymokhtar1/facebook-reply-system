<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” ØªØ´Ø®ÙŠØµ Ø´Ø§Ù…Ù„ Ù„Ù„Ù†Ø¸Ø§Ù…</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background: #e6ffe6; border-color: #4caf50; }
        .error { background: #ffe6e6; border-color: #f44336; }
        .warning { background: #fff3cd; border-color: #ffc107; }
        .info { background: #e3f2fd; border-color: #2196f3; }
        .loading { background: #f0f0f0; border-color: #999; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; font-size: 12px; max-height: 200px; overflow-y: auto; }
        .conversation { border: 1px solid #ddd; margin: 5px 0; padding: 10px; border-radius: 5px; background: #f9f9f9; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .status-indicator { display: inline-block; width: 12px; height: 12px; border-radius: 50%; margin-left: 8px; }
        .status-online { background: #4caf50; }
        .status-offline { background: #f44336; }
        .status-unknown { background: #ffc107; }
        .progress { width: 100%; height: 20px; background: #f0f0f0; border-radius: 10px; overflow: hidden; margin: 10px 0; }
        .progress-bar { height: 100%; background: #007bff; transition: width 0.3s ease; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ØªØ´Ø®ÙŠØµ Ø´Ø§Ù…Ù„ Ù„Ù„Ù†Ø¸Ø§Ù…</h1>
        
        <div class="section info">
            <h3>ğŸ“Š Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
            <p><strong>Ø§Ù„ÙˆÙ‚Øª:</strong> <span id="currentTime"></span></p>
            <p><strong>Ø§Ù„Ù…ØªØµÙØ­:</strong> <span id="browserInfo"></span></p>
            <p><strong>Ø§Ù„Ø´Ø§Ø´Ø©:</strong> <span id="screenInfo"></span></p>
            <p><strong>Ø§Ù„Ø§ØªØµØ§Ù„:</strong> <span id="connectionInfo"></span></p>
        </div>

        <div class="section">
            <h3>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
            <div class="grid">
                <div>
                    <button onclick="runAllTests()" id="runAllBtn">ğŸš€ ØªØ´ØºÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</button>
                    <button onclick="clearResults()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
                </div>
                <div>
                    <button onclick="testFrontendAPI()">âš›ï¸ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©</button>
                    <button onclick="testBackendAPI()">ğŸ”§ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³ÙŠØ±ÙØ±</button>
                    <button onclick="testProxy()">ğŸŒ Ø§Ø®ØªØ¨Ø§Ø± Proxy</button>
                </div>
            </div>
            <div class="progress" id="progressContainer" style="display: none;">
                <div class="progress-bar" id="progressBar"></div>
            </div>
        </div>

        <div id="results"></div>
    </div>

    <script>
        let testResults = {};
        let currentTest = 0;
        let totalTests = 0;

        // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        function updateSystemInfo() {
            document.getElementById('currentTime').textContent = new Date().toLocaleString('ar-EG');
            document.getElementById('browserInfo').textContent = navigator.userAgent.split(' ').slice(-2).join(' ');
            document.getElementById('screenInfo').textContent = `${screen.width}x${screen.height}`;
            document.getElementById('connectionInfo').textContent = navigator.onLine ? 'Ù…ØªØµÙ„' : 'ØºÙŠØ± Ù…ØªØµÙ„';
        }

        function addResult(title, content, type = 'info', id = null) {
            const resultsDiv = document.getElementById('results');
            const section = document.createElement('div');
            section.className = `section ${type}`;
            if (id) section.id = id;
            
            const statusIcon = type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸';
            
            section.innerHTML = `
                <h3>${statusIcon} ${title}</h3>
                <div>${content}</div>
            `;
            resultsDiv.appendChild(section);
            
            // ØªÙ…Ø±ÙŠØ± ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            section.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function updateProgress(current, total) {
            const progressContainer = document.getElementById('progressContainer');
            const progressBar = document.getElementById('progressBar');
            
            if (total > 0) {
                progressContainer.style.display = 'block';
                const percentage = (current / total) * 100;
                progressBar.style.width = percentage + '%';
                
                if (current >= total) {
                    setTimeout(() => {
                        progressContainer.style.display = 'none';
                    }, 2000);
                }
            }
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
            testResults = {};
            currentTest = 0;
            document.getElementById('progressContainer').style.display = 'none';
        }

        async function testFrontendAPI() {
            addResult('âš›ï¸ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©', 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...', 'loading', 'frontend-test');

            try {
                const startTime = Date.now();
                const response = await fetch('http://localhost:8080/');
                const endTime = Date.now();
                const duration = endTime - startTime;

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const content = await response.text();
                const hasReact = content.includes('react') || content.includes('React');
                const hasVite = content.includes('vite') || content.includes('Vite');

                testResults.frontend = {
                    status: 'success',
                    duration,
                    hasReact,
                    hasVite,
                    port: 8080
                };

                document.getElementById('frontend-test').className = 'section success';
                document.getElementById('frontend-test').innerHTML = `
                    <h3>âœ… Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ØªØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­</h3>
                    <div>
                        <p><strong>ğŸ“¡ Ø§Ù„Ù…Ù†ÙØ°:</strong> 8080</p>
                        <p><strong>â±ï¸ ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©:</strong> ${duration}ms</p>
                        <p><strong>âš›ï¸ React:</strong> ${hasReact ? 'Ù…ÙˆØ¬ÙˆØ¯' : 'ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'}</p>
                        <p><strong>âš¡ Vite:</strong> ${hasVite ? 'Ù…ÙˆØ¬ÙˆØ¯' : 'ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'}</p>
                        <p><strong>ğŸ“Š Ø­Ø¬Ù… Ø§Ù„Ù…Ø­ØªÙˆÙ‰:</strong> ${content.length} Ø­Ø±Ù</p>
                    </div>
                `;

            } catch (error) {
                testResults.frontend = { status: 'error', error: error.message };
                
                document.getElementById('frontend-test').className = 'section error';
                document.getElementById('frontend-test').innerHTML = `
                    <h3>âŒ ÙØ´Ù„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©</h3>
                    <div>
                        <p><strong>Ø§Ù„Ø®Ø·Ø£:</strong> ${error.message}</p>
                        <p><strong>Ø§Ù„Ø­Ù„ Ø§Ù„Ù…Ù‚ØªØ±Ø­:</strong> ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ npm run dev</p>
                    </div>
                `;
            }
        }

        async function testBackendAPI() {
            addResult('ğŸ”§ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³ÙŠØ±ÙØ±', 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...', 'loading', 'backend-test');

            try {
                const startTime = Date.now();
                const response = await fetch('http://localhost:3002/api/conversations?limit=5');
                const endTime = Date.now();
                const duration = endTime - startTime;

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                
                testResults.backend = {
                    status: 'success',
                    duration,
                    conversationsCount: data.length,
                    port: 3002
                };

                document.getElementById('backend-test').className = 'section success';
                document.getElementById('backend-test').innerHTML = `
                    <h3>âœ… Ø§Ù„Ø³ÙŠØ±ÙØ± ÙŠØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­</h3>
                    <div>
                        <p><strong>ğŸ“¡ Ø§Ù„Ù…Ù†ÙØ°:</strong> 3002</p>
                        <p><strong>â±ï¸ ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©:</strong> ${duration}ms</p>
                        <p><strong>ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª:</strong> ${data.length}</p>
                        <p><strong>ğŸ” Ø£ÙˆÙ„ Ù…Ø­Ø§Ø¯Ø«Ø©:</strong> ${data[0]?.customer_name || 'Ù„Ø§ ØªÙˆØ¬Ø¯'}</p>
                        <details>
                            <summary>ğŸ“‹ Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§Ù…</summary>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </details>
                    </div>
                `;

            } catch (error) {
                testResults.backend = { status: 'error', error: error.message };
                
                document.getElementById('backend-test').className = 'section error';
                document.getElementById('backend-test').innerHTML = `
                    <h3>âŒ ÙØ´Ù„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³ÙŠØ±ÙØ±</h3>
                    <div>
                        <p><strong>Ø§Ù„Ø®Ø·Ø£:</strong> ${error.message}</p>
                        <p><strong>Ø§Ù„Ø­Ù„ Ø§Ù„Ù…Ù‚ØªØ±Ø­:</strong> ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ npm run api</p>
                    </div>
                `;
            }
        }

        async function testProxy() {
            addResult('ğŸŒ Ø§Ø®ØªØ¨Ø§Ø± Proxy', 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...', 'loading', 'proxy-test');

            try {
                const startTime = Date.now();
                const response = await fetch('http://localhost:8080/api/conversations?limit=3');
                const endTime = Date.now();
                const duration = endTime - startTime;

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                
                testResults.proxy = {
                    status: 'success',
                    duration,
                    conversationsCount: data.length
                };

                document.getElementById('proxy-test').className = 'section success';
                document.getElementById('proxy-test').innerHTML = `
                    <h3>âœ… Proxy ÙŠØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­</h3>
                    <div>
                        <p><strong>ğŸ”— Ø§Ù„Ù…Ø³Ø§Ø±:</strong> localhost:8080/api â†’ localhost:3002/api</p>
                        <p><strong>â±ï¸ ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©:</strong> ${duration}ms</p>
                        <p><strong>ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª:</strong> ${data.length}</p>
                        <p><strong>âœ… CORS:</strong> ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­</p>
                        <details>
                            <summary>ğŸ“‹ Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</summary>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </details>
                    </div>
                `;

            } catch (error) {
                testResults.proxy = { status: 'error', error: error.message };
                
                document.getElementById('proxy-test').className = 'section error';
                document.getElementById('proxy-test').innerHTML = `
                    <h3>âŒ ÙØ´Ù„ Ø§Ø®ØªØ¨Ø§Ø± Proxy</h3>
                    <div>
                        <p><strong>Ø§Ù„Ø®Ø·Ø£:</strong> ${error.message}</p>
                        <p><strong>Ø§Ù„Ø­Ù„ Ø§Ù„Ù…Ù‚ØªØ±Ø­:</strong> ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª vite.config.ts</p>
                    </div>
                `;
            }
        }

        async function testReactHook() {
            addResult('âš›ï¸ Ø§Ø®ØªØ¨Ø§Ø± React Hook', 'Ø¬Ø§Ø±ÙŠ Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ù‡ÙˆÙƒ...', 'loading', 'hook-test');

            try {
                // Ù…Ø­Ø§ÙƒØ§Ø© useConversations hook
                const startTime = Date.now();
                const response = await fetch('/api/conversations?limit=50');
                const endTime = Date.now();
                const duration = endTime - startTime;

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                
                testResults.hook = {
                    status: 'success',
                    duration,
                    conversationsCount: data.length
                };

                document.getElementById('hook-test').className = 'section success';
                document.getElementById('hook-test').innerHTML = `
                    <h3>âœ… React Hook ÙŠØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­</h3>
                    <div>
                        <p><strong>ğŸ”— Ø§Ù„Ù…Ø³Ø§Ø±:</strong> /api/conversations (Ù†Ø³Ø¨ÙŠ)</p>
                        <p><strong>â±ï¸ ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©:</strong> ${duration}ms</p>
                        <p><strong>ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª:</strong> ${data.length}</p>
                        <p><strong>âœ… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:</strong> ${data.length > 0 ? 'Ù…ÙˆØ¬ÙˆØ¯Ø©' : 'ÙØ§Ø±ØºØ©'}</p>
                    </div>
                `;

            } catch (error) {
                testResults.hook = { status: 'error', error: error.message };
                
                document.getElementById('hook-test').className = 'section error';
                document.getElementById('hook-test').innerHTML = `
                    <h3>âŒ ÙØ´Ù„ Ø§Ø®ØªØ¨Ø§Ø± React Hook</h3>
                    <div>
                        <p><strong>Ø§Ù„Ø®Ø·Ø£:</strong> ${error.message}</p>
                        <p><strong>Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ù…Ø­ØªÙ…Ù„:</strong> Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ù€ proxy Ø£Ùˆ Ø§Ù„Ù‡ÙˆÙƒ</p>
                    </div>
                `;
            }
        }

        async function runAllTests() {
            const runAllBtn = document.getElementById('runAllBtn');
            runAllBtn.disabled = true;
            runAllBtn.textContent = 'ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ´ØºÙŠÙ„...';
            
            clearResults();
            
            const tests = [
                { name: 'Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©', func: testFrontendAPI },
                { name: 'Ø§Ù„Ø³ÙŠØ±ÙØ±', func: testBackendAPI },
                { name: 'Proxy', func: testProxy },
                { name: 'React Hook', func: testReactHook }
            ];
            
            totalTests = tests.length;
            currentTest = 0;
            
            for (const test of tests) {
                currentTest++;
                updateProgress(currentTest, totalTests);
                await test.func();
                await new Promise(resolve => setTimeout(resolve, 1000)); // Ø§Ù†ØªØ¸Ø§Ø± Ø«Ø§Ù†ÙŠØ© Ø¨ÙŠÙ† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
            }
            
            // ØªÙ‚Ø±ÙŠØ± Ù†Ù‡Ø§Ø¦ÙŠ
            generateFinalReport();
            
            runAllBtn.disabled = false;
            runAllBtn.textContent = 'ğŸš€ ØªØ´ØºÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª';
        }

        function generateFinalReport() {
            const successCount = Object.values(testResults).filter(r => r.status === 'success').length;
            const totalCount = Object.keys(testResults).length;
            const successRate = (successCount / totalCount) * 100;
            
            let reportType = 'success';
            let reportTitle = 'ğŸ‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù†Ø¬Ø­Øª!';
            let recommendations = '<p>âœ… Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ù…Ø«Ø§Ù„ÙŠ!</p>';
            
            if (successRate < 100) {
                reportType = successRate > 50 ? 'warning' : 'error';
                reportTitle = `âš ï¸ Ù†Ø¬Ø­ ${successCount} Ù…Ù† ${totalCount} Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª`;
                
                recommendations = '<h4>ğŸ’¡ Ø§Ù„ØªÙˆØµÙŠØ§Øª:</h4><ul>';
                if (testResults.frontend?.status === 'error') {
                    recommendations += '<li>ğŸ”§ Ø´ØºÙ„ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©: <code>npm run dev</code></li>';
                }
                if (testResults.backend?.status === 'error') {
                    recommendations += '<li>ğŸ”§ Ø´ØºÙ„ Ø§Ù„Ø³ÙŠØ±ÙØ±: <code>npm run api</code></li>';
                }
                if (testResults.proxy?.status === 'error') {
                    recommendations += '<li>ğŸ”§ ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª vite.config.ts</li>';
                }
                if (testResults.hook?.status === 'error') {
                    recommendations += '<li>ğŸ”§ ØªØ­Ù‚Ù‚ Ù…Ù† useConversations hook</li>';
                }
                recommendations += '</ul>';
            }
            
            addResult(reportTitle, `
                <p><strong>ğŸ“Š Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­:</strong> ${successRate.toFixed(1)}%</p>
                <p><strong>âœ… Ù†Ø¬Ø­:</strong> ${successCount}</p>
                <p><strong>âŒ ÙØ´Ù„:</strong> ${totalCount - successCount}</p>
                ${recommendations}
                <hr>
                <p><strong>ğŸ•’ ÙˆÙ‚Øª Ø§Ù„ØªØ´Ø®ÙŠØµ:</strong> ${new Date().toLocaleString('ar-EG')}</p>
            `, reportType);
        }

        // ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ
        window.addEventListener('load', () => {
            updateSystemInfo();
            setInterval(updateSystemInfo, 30000); // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
            
            // ØªØ´ØºÙŠÙ„ Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±ÙŠØ¹ Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†ÙŠ
            setTimeout(() => {
                addResult('ğŸ¯ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„ØªØ´Ø®ÙŠØµ Ø§Ù„Ø´Ø§Ù…Ù„', 
                    'Ø³ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±ÙŠØ¹ Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…...', 'info');
                setTimeout(runAllTests, 2000);
            }, 3000);
        });
    </script>
</body>
</html>
